# v1.1 å‡çº§æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ›´æ–°ä»£ç 
```bash
# æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨gitï¼‰
git pull origin main

# æˆ–è€…ç›´æ¥ä½¿ç”¨æ–°ä»£ç è¦†ç›–
```

### 2. å®‰è£…FFmpegï¼ˆæ¨èï¼‰
FFmpegç”¨äºé«˜æ•ˆçš„è§†é¢‘ç¼–ç ï¼Œå¯ä»¥å°†ä¼ è¾“ä½“ç§¯é™ä½96%ã€‚

#### Windows
```bash
# ä½¿ç”¨Chocolatey
choco install ffmpeg

# æˆ–ä¸‹è½½å¹¶æ·»åŠ åˆ°PATH
# https://ffmpeg.org/download.html
```

#### Linux (Ubuntu/Debian)
```bash
sudo apt-get update
sudo apt-get install ffmpeg
```

#### macOS
```bash
brew install ffmpeg
```

#### éªŒè¯å®‰è£…
```bash
ffmpeg -version
```

> **æ³¨æ„**ï¼šå¦‚æœä¸å®‰è£…FFmpegï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨OpenCVç¼–ç ï¼ˆä½“ç§¯ç•¥å¤§ä½†ä»å¯ç”¨ï¼‰

### 3. æ— éœ€ä¿®æ”¹é…ç½®
æ‰€æœ‰æ–°åŠŸèƒ½é»˜è®¤å¯ç”¨ï¼Œé…ç½®æ–‡ä»¶ä¿æŒä¸å˜ã€‚

### 4. é‡å¯æœåŠ¡
```bash
# åç«¯
cd backend
python app/main.py

# å‰ç«¯ï¼ˆå¦‚æœéœ€è¦é‡æ–°æ„å»ºï¼‰
cd frontend
npm run build  # ç”Ÿäº§ç¯å¢ƒ
npm run dev    # å¼€å‘ç¯å¢ƒ
```

---

## âœ¨ æ–°åŠŸèƒ½ä½¿ç”¨

### 1. æµå¼å¯¹è¯ï¼ˆé»˜è®¤å¯ç”¨ï¼‰

#### ç”¨æˆ·ä½“éªŒ
- å‘é€æ¶ˆæ¯å**ç«‹å³**çœ‹åˆ°æ•°å­—äººå¼€å§‹è¯´è¯
- æ–‡å­—**å®æ—¶**æ˜¾ç¤ºåœ¨èŠå¤©æ¡†
- **è¾¹ç”Ÿæˆè¾¹æ’­æ”¾**ï¼Œæ— éœ€ç­‰å¾…

#### æŠ€æœ¯ç»†èŠ‚
æµå¼æ¨¡å¼ä¸‹ï¼Œç³»ç»Ÿä¼šï¼š
1. æ¥æ”¶åˆ°LLMçš„æ¯ä¸ªæ–‡å­—ç‰‡æ®µç«‹å³æ˜¾ç¤º
2. æ£€æµ‹åˆ°å¥å­ç»“æŸï¼ˆã€‚ï¼ï¼Ÿç­‰ï¼‰ç«‹å³ç”Ÿæˆè§†é¢‘
3. è§†é¢‘åˆ†ç‰‡ä¼ è¾“å¹¶æ’é˜Ÿæ’­æ”¾

#### å‰ç«¯æ§åˆ¶
```typescript
// å¯ç”¨æµå¼ï¼ˆé»˜è®¤ï¼‰
send({
  type: 'text',
  text: 'ä½ å¥½',
  streaming: true
})

// ç¦ç”¨æµå¼ï¼ˆå…¼å®¹æ¨¡å¼ï¼‰
send({
  type: 'text',
  text: 'ä½ å¥½',
  streaming: false
})
```

---

### 2. è¯­éŸ³è¾“å…¥å¼€å…³

#### ç•Œé¢ä½ç½®
åœ¨é¡µé¢å³ä¸Šè§’ï¼Œæ‰¾åˆ° **"è¯­éŸ³è¾“å…¥"** å¼€å…³

#### ä½¿ç”¨åœºæ™¯
- **å¼€å¯**ï¼šæ˜¾ç¤º"æŒ‰ä½è¯´è¯"æŒ‰é’®ï¼Œæ”¯æŒè¯­éŸ³è¾“å…¥
- **å…³é—­**ï¼šéšè—è¯­éŸ³æŒ‰é’®ï¼Œä»…ä½¿ç”¨æ–‡å­—èŠå¤©

#### é€‚ç”¨äººç¾¤
- åŠå…¬å®¤ç­‰éœ€è¦å®‰é™ç¯å¢ƒçš„åœºæ™¯
- æ²¡æœ‰éº¦å…‹é£çš„è®¾å¤‡
- æ›´å–œæ¬¢æ‰“å­—çš„ç”¨æˆ·

---

### 3. å¯¹è¯è®°å½•æ§åˆ¶

#### ç•Œé¢ä½ç½®
åœ¨é¡µé¢å³ä¸Šè§’ï¼Œæ‰¾åˆ° **"å¯¹è¯è®°å½•"** å¼€å…³

#### ä½¿ç”¨åœºæ™¯
- **æ˜¾ç¤º**ï¼šæŸ¥çœ‹å®Œæ•´å¯¹è¯å†å²
- **éšè—**ï¼šä¸“æ³¨è§‚çœ‹æ•°å­—äººï¼Œæ•°å­—äººåŒºåŸŸè‡ªåŠ¨æ‰©å±•

#### æ•ˆæœ
éšè—å¯¹è¯è®°å½•åï¼š
- æ•°å­—äººæ˜¾ç¤ºåŒºåŸŸä»40%æ‰©å±•åˆ°100%
- æä¾›æ›´æ²‰æµ¸çš„è§‚çœ‹ä½“éªŒ
- é€‚åˆæ¼”ç¤ºã€å±•ç¤ºåœºæ™¯

---

## ğŸ¯ æ€§èƒ½æå‡

### å»¶è¿Ÿå¯¹æ¯”
| åœºæ™¯ | v1.0 | v1.1 | è¯´æ˜ |
|------|------|------|------|
| ç”¨æˆ·å‘é€æ¶ˆæ¯ | 0s | 0s | - |
| çœ‹åˆ°ç¬¬ä¸€ä¸ªå­— | 1.0-1.5s | **0.3-0.5s** | âš¡ æå‡60-70% |
| æ•°å­—äººå¼€å§‹è¯´è¯ | 1.5-2.0s | **0.5-0.8s** | âš¡ å®æ—¶å“åº” |
| å®Œæ•´å›å¤ç»“æŸ | 5-8s | 5-8s | æ€»æ—¶é•¿ç›¸åŒï¼Œä½†ä½“éªŒæ›´æµç•… |

### æµé‡å¯¹æ¯”
| åœºæ™¯ | v1.0 | v1.1 | è¯´æ˜ |
|------|------|------|------|
| 10ç§’è§†é¢‘ | ~50MB | **~2MB** | ğŸ“‰ å‡å°‘96% |
| 30ç§’è§†é¢‘ | ~150MB | **~6MB** | ğŸ“‰ å‡å°‘96% |
| 1åˆ†é’Ÿè§†é¢‘ | ~300MB | **~12MB** | ğŸ“‰ å‡å°‘96% |

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¿˜æ˜¯æœ‰å»¶è¿Ÿï¼Ÿ
**A**: 
- **LLMå»¶è¿Ÿ**ï¼šå¤§æ¨¡å‹ç”Ÿæˆç¬¬ä¸€ä¸ªå­—éœ€è¦æ—¶é—´ï¼ˆæ— æ³•é¿å…ï¼‰
- **TTSå»¶è¿Ÿ**ï¼šè¯­éŸ³åˆæˆéœ€è¦æ—¶é—´ï¼ˆ~100-200msï¼‰
- **Avatarå»¶è¿Ÿ**ï¼šè§†é¢‘ç”Ÿæˆéœ€è¦æ—¶é—´ï¼ˆ~200-300msï¼‰
- **ç½‘ç»œå»¶è¿Ÿ**ï¼šä¼ è¾“éœ€è¦æ—¶é—´ï¼ˆå–å†³äºå¸¦å®½ï¼‰

v1.1é€šè¿‡**æµå¼å¤„ç†**ï¼Œè®©è¿™äº›å»¶è¿Ÿ**å¹¶è¡Œ**è€Œä¸æ˜¯**ä¸²è¡Œ**ï¼Œå¤§å¹…æå‡ä½“éªŒã€‚

### Q2: æ²¡æœ‰FFmpegä¼šæ€æ ·ï¼Ÿ
**A**: 
- ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹FFmpegæ˜¯å¦å¯ç”¨
- å¦‚æœæ²¡æœ‰ï¼Œè‡ªåŠ¨ä½¿ç”¨OpenCVç¼–ç 
- åŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼Œåªæ˜¯è§†é¢‘ä½“ç§¯ç¨å¤§ï¼ˆ~5-10MB/10ç§’ï¼‰
- **å»ºè®®å®‰è£…FFmpegä»¥è·å¾—æœ€ä½³æ€§èƒ½**

### Q3: å¦‚ä½•ç¡®è®¤æµå¼æ¨¡å¼å·¥ä½œï¼Ÿ
**A**: 
æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
WebSocket connected
Extracted X mel chunks from audio
Generated video: XXXX bytes
Video chunk incoming: XXXX bytes
```

åŒæ—¶ï¼ŒèŠå¤©æ¡†ä¸­çš„æ–‡å­—ä¼š**é€å­—å‡ºç°**è€Œä¸æ˜¯ä¸€æ¬¡æ€§æ˜¾ç¤ºã€‚

### Q4: è§†é¢‘æ’­æ”¾å¡é¡¿ï¼Ÿ
**A**: å¯èƒ½åŸå› ï¼š
1. **CPUæ€§èƒ½ä¸è¶³**ï¼šé™ä½åˆ†è¾¨ç‡ï¼ˆè®¾ç½®ä¸­æ”¹ä¸º256x256ï¼‰
2. **ç½‘ç»œå»¶è¿Ÿ**ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥
3. **å¹¶å‘è¿‡é«˜**ï¼šå‡å°‘åŒæ—¶å¯¹è¯çš„ç”¨æˆ·æ•°

ä¼˜åŒ–æ–¹æ³•ï¼š
```yaml
# config/config.yaml
avatar:
  fps: 20           # é™ä½å¸§ç‡
  resolution: [256, 256]  # é™ä½åˆ†è¾¨ç‡
  static_mode: true # å¯ç”¨é™æ€æ¨¡å¼ï¼ˆä»…ä½¿ç”¨å•å¸§ï¼‰
```

### Q5: Wav2Lipå˜´å‹è¿˜æ˜¯ä¸åŒæ­¥ï¼Ÿ
**A**: æ£€æŸ¥ï¼š
1. **æ¨¡å‹æ–‡ä»¶**ï¼šç¡®ä¿`models/wav2lip_cpu.onnx`å­˜åœ¨
2. **éŸ³é¢‘è´¨é‡**ï¼šç¡®ä¿TTSè¾“å‡ºæ­£å¸¸
3. **æ—¥å¿—ä¿¡æ¯**ï¼šæŸ¥çœ‹`logs/app.log`ä¸­æ˜¯å¦æœ‰melæå–é”™è¯¯

å¦‚æœä»æœ‰é—®é¢˜ï¼Œå¯èƒ½éœ€è¦ï¼š
- é‡æ–°è½¬æ¢Wav2Lipæ¨¡å‹ä¸ºONNXæ ¼å¼
- æ£€æŸ¥MediaPipeäººè„¸æ£€æµ‹æ˜¯å¦æ­£å¸¸

---

## ğŸ› ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰å¥å­æ£€æµ‹
```python
# backend/core/session_manager.py

def _is_sentence_end(self, text: str) -> bool:
    """è‡ªå®šä¹‰å¥å­ç»“æŸæ£€æµ‹"""
    delimiters = ['ã€‚', 'ï¼', 'ï¼Ÿ', '.', '!', '?', 'ï¼›', ';', '\n']
    
    # æ·»åŠ è‡ªå®šä¹‰åˆ†éš”ç¬¦
    delimiters.append('ï¼š')  # å†’å·
    delimiters.append(',')   # é€—å·ï¼ˆæ›´çŸ­çš„å¥å­ï¼‰
    
    return any(text.rstrip().endswith(d) for d in delimiters)
```

### è°ƒæ•´è§†é¢‘ç¼–ç è´¨é‡
```python
# backend/utils/video_utils.py

ffmpeg_cmd = [
    # ...
    '-crf', '18',  # æ”¹ä¸º18ï¼ˆæ›´é«˜è´¨é‡ï¼‰æˆ–28ï¼ˆæ›´å°ä½“ç§¯ï¼‰
    # é»˜è®¤23æ˜¯å¹³è¡¡ç‚¹
    # ...
]
```

### ç¦ç”¨æµå¼æ¨¡å¼ï¼ˆå…¨å±€ï¼‰
```python
# backend/app/main.py

# å°†é»˜è®¤å€¼æ”¹ä¸ºFalse
use_streaming = data.get("streaming", False)  # æ”¹ä¸ºFalse
```

---

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
# Linux/Mac
tail -f logs/app.log

# Windows
Get-Content logs/app.log -Wait
```

### å…³é”®æ—¥å¿—ä¿¡æ¯
```
INFO: Extracted 45 mel chunks from audio  # melæå–æˆåŠŸ
INFO: Generated video: 245678 bytes       # è§†é¢‘ç”ŸæˆæˆåŠŸ
INFO: Sentence processed: 245678 bytes    # å¥å­å¤„ç†å®Œæˆ
INFO: Processing sentence: ä½ å¥½...       # æ­£åœ¨å¤„ç†å¥å­
```

### æ€§èƒ½ç›‘æ§
è®¿é—®ç›‘æ§é¢æ¿æŸ¥çœ‹å®æ—¶æ€§èƒ½ï¼š
```
http://localhost:3001
```

å…³æ³¨æŒ‡æ ‡ï¼š
- **Avatarå¤„ç†æ—¶é—´**ï¼šåº”è¯¥åœ¨200-500ms
- **TTSå¤„ç†æ—¶é—´**ï¼šåº”è¯¥åœ¨100-300ms
- **å†…å­˜ä½¿ç”¨**ï¼šåº”è¯¥åœ¨2-3GB

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒå»ºè®®
- âœ… å®‰è£…FFmpeg
- âœ… ä½¿ç”¨HTTPS
- âœ… é…ç½®CDNåŠ é€Ÿè§†é¢‘ä¼ è¾“
- âœ… å¯ç”¨Redisç¼“å­˜ï¼ˆæœªæ¥ç‰ˆæœ¬ï¼‰

### 2. ä½é…ç½®æœåŠ¡å™¨ä¼˜åŒ–
```yaml
# config/config.yaml
avatar:
  fps: 20
  resolution: [256, 256]
  static_mode: true  # ä»…ä½¿ç”¨é™æ€å›¾ç‰‡
  
whisper:
  model: "tiny"  # ä½¿ç”¨æœ€å°æ¨¡å‹
```

### 3. é«˜å¹¶å‘ä¼˜åŒ–
```yaml
# config/config.yaml
system:
  max_sessions: 5   # é™åˆ¶å¹¶å‘æ•°
  session_timeout: 180  # ç¼©çŸ­è¶…æ—¶æ—¶é—´
```

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

### æäº¤Issue
https://github.com/yourusername/lightweight-avatar-chat/issues

### æŸ¥çœ‹æ–‡æ¡£
- [ä½¿ç”¨æŒ‡å—](USAGE.md)
- [APIæ–‡æ¡£](api.md)
- [é…ç½®è¯´æ˜](configuration.md)

### ç¤¾åŒºæ”¯æŒ
- è®¨è®ºåŒºï¼šï¼ˆå¾…æ·»åŠ ï¼‰
- é‚®ä»¶ï¼šï¼ˆå¾…æ·»åŠ ï¼‰

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

